---
title: "SABRmetrics"
subtitle: "making baseball as much fun as doing your taxes"
author: "tut2_team5 <br> Mohamad, Adam and Jimmy"
institute: "University of Edinburgh"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---


```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
```

```{r setup, include=FALSE}
# For better figure resolution
knitr::opts_chunk$set(fig.dpi = 600, fig.asp = 0.618, out.height = "10%")
```


```{r load-data, echo = FALSE, messages = FALSE, results = FALSE, warning = FALSE, include = FALSE}
teams_cleaned <- read_csv("/cloud/project/data/teams-cleaned.csv")

#doing training split
set.seed(3)
teams_split <- initial_split(teams_cleaned, prop = 0.80)
teams_train <- training(teams_split)
teams_test <- testing(teams_split)

#have a lot of NAs for drs and uzr/uzr150/def, so he's something to deal with
#that:
teams_train %>%
  filter(is.na(mean_drs) == FALSE) -> teams_train_drs
teams_train %>%
  filter(is.na(mean_uzr) == FALSE) -> teams_train_uzr
```

class: center, middle

## We will be using SABRmetrics (the empirical analysis of baseball statistics)
## to look at how effectively different measurements for evaluating individual player performance predict team success.

---

class: inverse, center, middle

# Data

---

# Sources

- Our data was sourced from [retrosheet.org](retrosheet.org) and [fangraphs.com](fangraphs.com)

- We considered only the seasons from 1998-2019 because 1998 is after teams starting
recording data and 1998 is the first season to have 30 teams.

- 2020 data was not considered because the season started later and only 60 games
were played which is much less than usual.

- The batting and fielding statistics from fangraphs were webscraped from fangraphs.

- The teams win and performance statistics were downloaded from the Chadwick Bureau
which was originally sourced from retrosheet.

.footnote[
  All UZR stats provided to fan graphs are courtesy of a legend called Michael Lichtman.
]

---

# Web scraping + Clean up

.pull-left[
- Fangraphs, unfortunately does not have ready to download datasets. However, so
a script was used to retrieve defensive and field statistics from the website.

- The website allows robots. However, it adds a CAPTCHA wall, if you make too
many requests so the website is not slowed for other users so it and also there
were many dead links which made the task much harder and take ages.

```{r captcha-demo}
tryCatch(
  expr = { 
    #scrape the data
  },
  error =  function(e){ 
      if(e[1] == "HTTP error 500."){ 
        #i.e. page does not exist
        #do not return anything
      }else{
        #stop scraping until I manually 
        #solve the CAPTCHA
      }
  }
)
```


]

.pull-right[

- Fielding and batting stats were scraped for each player for each season.

- which was later summarised into a smaller dataset that contained the weighted
average for each stat for each team.

- then joined each teams season statistics to the retrosheet's dataframe
which contained team performance metrics like win rate and whether they won the
world series or not.

]

---

#Team data

```{r head, echo = FALSE, messages = FALSE}
kable(head(teams_cleaned[,1:10]), format = "html")
```
\+ 10 more cols.
---

class: inverse, middle, center

# Data Analysis

---

#Data Analysis

- We started by looking at each of the 16 variables separately and their relationship with the 
win rate. 

- and examined the residual vs. fitted plots to assess whether the linear model
is appropriate.

- and evaluated the accuracy of the model predictions.

- Finally, we created a multi variable model.

---

class: inverse, center, middle

# Single Variable Linear Regression

---

# Batting Average (AVG)

.pull-left[
```{r batting-average, message = FALSE, echo = FALSE}
#It's the same process for every variable, so I'll just walk
#through the first one.

#create graph, add linear model trend line
teams_train %>%
  ggplot(mapping = aes(x = mean_avg , y = win_rate)) +
  geom_point(size = 1.2, alpha = 0.35) +
  geom_smooth(method = "lm")

#linear model, note R squared and adjusted R squared
avg_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(win_rate ~ mean_avg, data = teams_train)

kable(tidy(avg_fit), format = "html")
```
]

.pull-right[
```{r res-avg, echo = FALSE, message = FALSE}
#residuals analysis
avg_aug <- augment(avg_fit$fit)
ggplot(data = avg_aug,
       aes(x = .fitted,
           y = .resid)) +
  geom_jitter() +
  geom_hline(yintercept = 0,
             linetype = "dashed")

kable(glance(avg_fit)[c(1:3)], format = "html")
```
]

---

# Slugging Percentage (SLG)

.pull-left[
```{r slugging-percentage, echo = FALSE}
teams_train %>%
  ggplot(mapping = aes(x = mean_slg , y = win_rate)) +
  geom_point(size = 1.2, alpha = 0.35) +
  geom_smooth(method = "lm")

slg_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(win_rate ~ mean_slg, data = teams_train)
tidy(slg_fit)
glance(slg_fit)
```
]

.pull-right[

]

---

# Isolated Power (ISO)

```{r isolated-power, echo = FALSE}
teams_train %>%
  ggplot(mapping = aes(x = mean_iso , y = win_rate)) +
  geom_point(size = 1.2, alpha = 0.35) +
  geom_smooth(method = "lm")

iso_fit <- linear_reg() %>%
  set_engine("lm") %>%
  fit(win_rate ~ mean_iso, data = teams_train)
tidy(iso_fit)
glance(iso_fit)

iso_aug <- augment(iso_fit$fit)
ggplot(data = iso_aug,
       aes(x = .fitted,
           y = .resid)) +
  geom_jitter() +
  geom_hline(yintercept = 0,
             linetype = "dashed")
```

---

# Tables

If you want to generate a table, make sure it is in the HTML format (instead of Markdown or other formats), e.g.,

```{r iris-table, echo = FALSE}
kable(head(iris), format = "html")
```

---

# Images

```{r castle, echo = FALSE, out.width = "60%", fig.align = "center", fig.cap = "Image credit: Photo by JÃ¶rg Angeli on Unsplash."}
include_graphics("https://images.unsplash.com/photo-1535448033526-c0e85c9e6968?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1650&q=80")
```

Or you can also include a full page image. See next slide.

---

background-image: url(https://images.unsplash.com/photo-1535448033526-c0e85c9e6968?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1650&q=80)

---

# Math Expressions

You can write LaTeX math expressions inside a pair of dollar signs, e.g. &#36;\alpha+\beta$ renders $\alpha+\beta$. You can use the display style with double dollar signs:

```
$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$
```

$$\bar{X}=\frac{1}{n}\sum_{i=1}^nX_i$$

Limitations:

1. The source code of a LaTeX math expression must be in one line, unless it is inside a pair of double dollar signs, in which case the starting `$$` must appear in the very beginning of a line, followed immediately by a non-space character, and the ending `$$` must be at the end of a line, led by a non-space character;

1. There should not be spaces after the opening `$` or before the closing `$`.

1. Math does not work on the title slide (see [#61](https://github.com/yihui/xaringan/issues/61) for a workaround).

---

# Feeling adventurous?

- Want to find out more about `xaringan`? See https://slides.yihui.name/xaringan/#1.

- You are welcomed to use the default styling of the slides. In fact, that's what I expect majority of you will do. You will differentiate yourself with the content of your presentation.

- But some of you might want to play around with slide styling. The 
`xaringanthemer` provides some solutions for this that: https://pkg.garrickadenbuie.com/xaringanthemer.

- And if you want more bells and whistles, there is also `xaringanExtra`: https://pkg.garrickadenbuie.com/xaringanExtra.
